!function t(r,e,n){function o(a,i){if(!e[a]){if(!r[a]){var c="function"==typeof require&&require;if(!i&&c)return c(a,!0);if(u)return u(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var f=e[a]={exports:{}};r[a][0].call(f.exports,function(t){var e=r[a][1][t];return o(e||t)},f,f.exports,t,r,e,n)}return e[a].exports}for(var u="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(t,r,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createView=function(t,r){var e=document.createElement("div"),n=document.createElement("canvas");n.addEventListener("click",function(t){var e={col:Math.floor(t.offsetX/20),row:Math.floor(t.offsetY/20)};r(e.row,e.col)}),n.setAttribute("width","401px"),n.setAttribute("height","401px"),e.appendChild(n);var o=n.getContext("2d");function u(){o.clearRect(0,0,n.width,n.height),o.lineWidth=1,o.strokeStyle="#ccc",o.beginPath(),o.moveTo(0,400.5),o.lineTo(401,400.5),o.stroke(),o.beginPath(),o.moveTo(400.5,0),o.lineTo(400.5,401),o.stroke();for(var r=0;r<t.length;r++)o.beginPath(),o.moveTo(0,20*r+.5),o.lineTo(400,20*r+.5),o.stroke(),o.beginPath(),o.moveTo(20*r+.5,0),o.lineTo(20*r+.5,400),o.stroke()}u();var a=document.getElementById("board");a.parentNode.replaceChild(e,a),e.id="board";function i(t,r,n){0===n?(o.beginPath(),o.strokeStyle="#8d1",o.lineWidth=2,o.moveTo(20*r+3.5,20*t+3.5),o.lineTo(20*r+17.5,20*t+17.5),o.stroke(),o.moveTo(20*r+17.5,20*t+3.5),o.lineTo(20*r+3.5,20*t+17.5),o.stroke()):(o.beginPath(),o.strokeStyle="#fa3",o.lineWidth=2,o.arc(20*r+10.5,20*t+10.5,6.5,0,2*Math.PI),o.stroke());var u=document.createTextNode("["+r+", "+t+"]"),a=document.createElement("div");return a.appendChild(u),e.appendChild(a),new Promise(function(t){return requestAnimationFrame(function(){return t()})}).then(function(){return{row:t,col:r}})}return{drawGameOver:function(r,n,u){e.appendChild(document.createTextNode("GAME OVER"));var a=u+1;function i(e,o){for(var u=r+e,i=n+o,c=0;u>=0&&i>=0&&u<t.length&&t[u]&&i<t[u].length&&t[u][i].value===a;)u+=e,i+=o,c++;return c}function c(t,r,e,n){o.beginPath(),o.strokeStyle="#f00",o.lineWidth=3,o.moveTo(t,r),o.lineTo(e,n),o.stroke()}i(-1,0)+i(1,0)>=4&&c(20*n+10.5,20*(r-i(-1,0))+2,20*n+10.5,20*(r+i(1,0))+18);if(i(-1,-1)+i(1,1)>=4){var l=i(-1,-1),f=i(1,1);c(20*(n-l)+2,20*(r-l)+2,20*(n+f)+18,20*(r+f)+18)}if(i(-1,1)+i(1,-1)>=4){var s=i(-1,1),v=i(1,-1);c(20*(n+s)+18,20*(r-s)+2,20*(n-v)+2,20*(r+v)+18)}i(0,-1)+i(0,1)>=4&&c(20*(n-i(0,-1))+2,20*r+10.5,20*(n+i(0,1))+18,20*r+10.5)},draw:i,redraw:function(r){t=r,u();for(var e=0;e<t.length;e++)for(var n=t[e],o=0;o<n.length;o++){var a=n[o].value;0!==a&&i(e,o,a-1)}},showError:function(t){console.error(t),e.innerHTML=t.message+"<br><pre>"+t.stack+"</pre>"}}}},{}],2:[function(t,r,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={createPlayer:function(){var t=null,r=null,e={};return e.makeTurn=function(e){return t=e,new Promise(function(t){r=t})},e.respond=function(e,n){t&&0===t[e][n]&&(t=null,r({row:e,col:n}))},e}}},{}],3:[function(t,r,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.calcFitness=function(t){function r(r){var e=r.row,n=r.col;return e>=0&&n>=0&&e<t.length&&t[e]&&n<t[e].length}function e(t,r){return{row:t.row+r.row,col:t.col+r.col}}function n(r){var e=r.row,n=r.col;return t[e][n]}function o(t,o){return function(t,o,u,a,i){i=i||5;for(var c=0;c<i&&r(t);c++)a=u(n(t),a,t),t=e(t,o);return a}(t,o,function(t,r){return r[t+1]++,r},[0,0,0])}for(var u=[{row:1,col:0},{row:0,col:1},{row:1,col:1},{row:-1,col:1}],a=[0,0,0,0,0,0,0,0,0,0],i=0;i<t.length;i++)for(var c=0;c<t[i].length;c++)for(var l={row:i,col:c},f=0;f<u.length;f++){var s=u[f],v=e(l,(g=s,w=4,{row:g.row*w,col:g.col*w}));if(r(v)){var h=o(l,s);if(h[0]>0&&h[2]>0||5===h[1])continue;h[0]>0?a[4+h[0]]++:a[5-h[2]]++}}var g,w;return a}},{}],4:[function(t,r,e){"use strict";var n=i(t("./console-player.js")),o=t("./fitness-function.js"),u=t("./board-view.js"),a=(i(t("./simple-algo.js")),i(t("./simple-algo-v2.js")));i(t("./tactic-algo.js"));function i(t){return t&&t.__esModule?t:{default:t}}var c=null;function l(t){var r=Array(20).fill(0).map(function(){return Array(20).fill(0).map(function(t){return{value:0,element:null}})}),e=t||[];!function(){for(var t=0,n=0;n<e.length;n++){var o=e[n];r[o.row][o.col].value=t+1,t=1-t}}();var i=null;var l=(0,u.createView)(r,function(t,r){i&&"function"==typeof i.respond&&i.respond(t,r)});l.redraw(r),c={board:r,history:e,turn:e.length%2,state:0,players:[n.default.createPlayer(),a.default.createPlayer()]};var f=null,s=void 0;!function t(n){try{switch(c.state){case 0:return c.state=1,i=c.players[c.turn],u=c.turn,u++,s=c.board.map(function(t){return t.map(function(t){return 0===t.value?0:t.value===u?1:-1})}),console.log((0,o.calcFitness)(s)),void Promise.resolve(i.makeTurn(s,f)).then(t).catch(function(r){c.state=-1,t(r)});case 1:if(c.state=2,f={row:n.row,col:n.col},"number"!=typeof n.row||"number"!=typeof n.col||n.row<0||n.row>=r.length||!r[n.row]||n.col<0||n.col>=r[n.row].length||0!==r[n.row][n.col].value)throw new Error("Invalid move data ["+n.row+","+n.col+"]...");return c.board[n.row][n.col].value=c.turn+1,e.push({row:n.row,col:n.col}),void l.draw(n.row,n.col,c.turn).then(t);case 2:return function(t,r){var e=c.turn+1;function n(n,o){for(var u=t,a=r,i=c.board,l=0;u>=0&&a>=0&&u<i.length&&i[u]&&a<i[u].length&&i[u][a].value===e;)u+=n,a+=o,l++;return l}return n(-1,0)+n(1,0)>5||n(-1,-1)+n(1,1)>5||n(-1,1)+n(1,-1)>5||n(0,-1)+n(0,1)>5}(n.row,n.col)?c.state=3:(c.state=0,c.turn=1-c.turn),void Promise.resolve().then(function(){return t(n)});case 3:return void l.drawGameOver(n.row,n.col,c.turn);case-1:return void l.showError(n)}}catch(r){c.state=-1,t(r)}var u}()}l();document.getElementById("start").addEventListener("click",function(){return l()}),document.getElementById("undo").addEventListener("click",function(){c&&c.history&&c.history.length&&l(c.history.slice(0,c.history.length-2))})},{"./board-view.js":1,"./console-player.js":2,"./fitness-function.js":3,"./simple-algo-v2.js":5,"./simple-algo.js":6,"./tactic-algo.js":7}],5:[function(t,r,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={createPlayer:function(){var t={};return t.makeTurn=function(t){return Promise.resolve().then(function(){function r(r){var e=r.row,n=r.col;return e>=0&&n>=0&&e<t.length&&t[e]&&n<t[e].length}function e(t,r){return{row:t.row+r.row,col:t.col+r.col}}function n(t,r){return{row:t.row*r,col:t.col*r}}function o(r){var e=r.row,n=r.col;return t[e][n]}function u(t,n,u,a,i){i=i||5;for(var c=0;c<i&&r(t);c++)a=u(o(t),a,t),t=e(t,n);return a}function a(t,u,a){var i=t.length;if(!r(e(u,n(a,i-1))))return!1;for(var c=0;c<i;c++){if(o(u)!==t[c])return!1;u=e(u,a)}return!0}for(var i=[{pattern:[0,1,1,1,1],goto:0,weight:10001},{pattern:[1,0,1,1,1],goto:1,weight:10001},{pattern:[1,1,0,1,1],goto:2,weight:10001},{pattern:[1,1,1,0,1],goto:3,weight:10001},{pattern:[1,1,1,1,0],goto:4,weight:10001},{pattern:[0,-1,-1,-1,-1],goto:0,weight:1e4},{pattern:[-1,0,-1,-1,-1],goto:1,weight:1e4},{pattern:[-1,-1,0,-1,-1],goto:2,weight:1e4},{pattern:[-1,-1,-1,0,-1],goto:3,weight:1e4},{pattern:[-1,-1,-1,-1,0],goto:4,weight:1e4},{pattern:[0,0,1,1,1,0],goto:1,weight:1001},{pattern:[0,1,0,1,1,0],goto:2,weight:1001},{pattern:[0,1,1,0,1,0],goto:3,weight:1001},{pattern:[0,1,1,1,0,0],goto:4,weight:1001},{pattern:[0,0,-1,-1,-1,0],goto:1,weight:1e3},{pattern:[0,-1,0,-1,-1,0],goto:2,weight:1e3},{pattern:[0,-1,-1,0,-1,0],goto:3,weight:1e3},{pattern:[0,-1,-1,-1,0,0],goto:4,weight:1e3}],c=[{row:1,col:0},{row:0,col:1},{row:1,col:1},{row:-1,col:1}],l=[],f=t.map(function(t){return t.map(function(t){return 0})}),s=t.map(function(t){return t.map(function(t){return 0})}),v=(t.map(function(t){return t.map(function(t){return 0})}),[0,1,5,10,50]),h=0;h<t.length;h++)for(var g=0;g<t[h].length;g++)for(var w={row:h,col:g},d=0;d<c.length;d++){var p=c[d];if(l=l.concat(i.filter(function(t){return a(t.pattern,w,p)}).map(function(t){return Object.assign({weight:t.weight,pattern:t},e(w,n(p,t.goto)))})),r(e(w,n(p,4)))){var m=(b=w,k=p,u(b,k,function(t,r){return r[t+1]++,r},[0,0,0]));if(m[0]>0&&m[2]>0||5===m[1])continue;if(m[0]>0){var y=v[m[0]];u(w,p,function(t,r,e){return s[e.row][e.col]+=0===t?y:0})}else y=v[m[2]],u(w,p,function(t,r,e){return f[e.row][e.col]+=0===t?y:0})}}var b,k;if(l.length>0)return l.sort(function(t,r){return t.weight!==r.weight?r.weight-t.weight:f[r.row][r.col]+s[r.row][r.col]-f[t.row][t.col]-s[t.row][t.col]+2*(Math.random()-.5)}),l[0];for(var P=Math.round(t.length/2)+1,T=Math.round(t[0].length/2)+1,M=0,j=0;j<t.length;j++)for(var E=0;E<t[j].length;E++)0===t[j][E]&&f[j][E]+s[j][E]+.1*(Math.random()-.5)>M&&(T=E,P=j,M=f[j][E]+s[j][E]);return{row:P,col:T}})},t}}},{}],6:[function(t,r,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={createPlayer:function(){var t={};return t.makeTurn=function(t){return Promise.resolve().then(function(){function r(r,e,n,o,u,a){for(var i=r,c=e,l=0;i>=0&&c>=0&&i<t.length&&t[i]&&c<t[i].length&&l<5;)a=u(t[i][c],a,i,c),i+=n,c+=o,l++;return a}for(var e=t.map(function(t){return t.map(function(t){return 0})}),n=t.map(function(t){return t.map(function(t){return 0})}),o=[0,1,5,10,50],u=0;u<t.length;u++)for(var a=0;a<t[u].length;a++)for(var i=[[1,0],[0,1],[1,1],[-1,1]],c=0;c<i.length;c++){var l=i[c],f=u+4*l[0],s=a+4*l[1];if(f>=0&&s>=0&&f<t.length&&s<t[0].length){var v=(g=u,w=a,d=l[0],p=l[1],r(g,w,d,p,function(t,r){return r[t+1]++,r},[0,0,0]));if(v[0]>0&&v[2]>0||5===v[1])continue;if(v[0]>0){var h=o[v[0]];r(u,a,l[0],l[1],function(t,r,e,o){return n[e][o]+=0===t?h:0})}else h=o[v[2]]-.1,r(u,a,l[0],l[1],function(t,r,n,o){return e[n][o]+=0===t?h:0})}}for(var g,w,d,p,m=Math.round(t.length/2),y=Math.round(t[0].length/2),b=0,k=0;k<t.length;k++)for(var P=0;P<t[k].length;P++)0===t[k][P]&&e[k][P]+n[k][P]>b&&(y=P,m=k,b=e[k][P]+n[k][P]);return{row:m,col:y}})},t}}},{}],7:[function(t,r,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={createPlayer:function(){var t={};function r(t,r){return function(t){return Math.random()}}function e(t,e,n){var o=function(t){for(var r=[],e=0;e<t.rowCount;e++)for(var n=0;n<t.colCount;n++){var o={row:e,col:n};0===t.get(o)&&r.push(o)}return r}(t),u=r();return a=u,i=n,o.map(function(t){return{move:t,fitness:a(t),history:(i&&i.history||[]).concat([t])}});var a,i}function n(t,r){return function(t,r){function e(){r>0?t.sort(function(t,r){return r.fitness-t.fitness}):t.sort(function(t,r){return t.fitness-r.fitness})}return e(),{peek:function(){if(t.length>0)return t[0];throw new Error("Can not peek item. Queue contains no elements.")},update:function(){e()}}}(e(t),r)}return t.makeTurn=function(t,r){for(var o=function(){var t=1e3;return{haveTime:function(){return t-- >0}}}(),u=function t(r,e){return{board:r,rowCount:r.length,colCount:r[0].length,get:function(t){return r[t.row][t.col]},lastTurn:e,apply:function(e){var n=r.map(function(t){return t.map(function(t){return t})}),o=1;return e.history.forEach(function(t){n[t.row][t.col]=o,o=-o}),t(n,e.move)}}}(t,r),a=n(u,1);o.haveTime();){var i=a.peek(),c=u.apply(i);if(i.variants&&i.variants.length){var l=i.variants.peek();1===i.variants.length&&a.pop();var f=e(c=c.apply(l),0,i);a.enque(f)}else i.variants=n(c,-1),i.fitness=i.variants.peek().fitness,a.update(i)}return{row:10,col:10}},t}}},{}]},{},[4]);
//# sourceMappingURL=index.js.map
